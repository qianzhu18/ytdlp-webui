这份文档专为你（macOS 用户）定制。基于你的需求（免费、快速、本地化、图形界面），这是从零开始到最终生成 `.app` 程序的完整执行手册。

---

## macOS 本地油管下载器封装手册

### 第一阶段：地基搭建 (Terminal 操作)

macOS 必须通过 Homebrew 安装 FFmpeg（核心依赖），否则下载的 1080P/4K 视频会没有声音。

1. **打开终端 (Terminal)**。
2. **安装 FFmpeg 和 Python** (如果你已安装 Homebrew)：
```bash
brew install ffmpeg python

```


*(如果没有 Homebrew，请先去 brew.sh 复制那行命令安装，这是 Mac 开发必备)*
3. **安装 Python 依赖库**：
```bash
pip3 install yt-dlp pyinstaller tk

```



---

### 第二阶段：AI 生成核心代码 (核心步骤)

打开你的 AI 编程工具（Cursor/ChatGPT 等），**直接复制**以下优化后的 Prompt。这段 Prompt 针对 macOS 进行了适配（如路径格式、Cookie 调用）。

> **复制此 Prompt：**
> 请帮我用 Python 编写一个 macOS 本地专用的 YouTube 视频下载器 GUI。
> **技术栈：** Python + Tkinter + yt_dlp
> **功能极其具体的要求：**
> 1. **界面设计：**
> * 窗口标题："Mac YouTube Downloader"
> * 布局简洁：一行 URL 输入框，一个默认勾选的复选框 "读取 Chrome Cookie (解决限速/403)"，一个明显的 "开始下载" 按钮。
> * 底部放置一个多行文本框 (`ScrolledText`) 用于显示实时日志。
> 
> 
> 2. **核心逻辑 (yt_dlp)：**
> * **必须**在子线程中运行下载，防止 Mac 出现彩虹球（界面卡死）。
> * **Cookie 策略：** 当复选框被勾选时，添加参数 `{'cookiesfrombrowser': ('chrome',)}`。这是绕过 YouTube 限制的关键。
> * **格式策略：** 默认使用 `'format': 'bestvideo+bestaudio/best', 'merge_output_format': 'mp4'`。
> * **路径策略：** 默认下载到用户桌面的 `Downloads` 文件夹 (使用 `os.path.expanduser('~/Downloads')`)。
> 
> 
> 3. **日志系统：** 重写 yt_dlp 的 logger，将 stdout 输出实时重定向到界面的文本框中，让我能看到进度条。
> 4. **结束反馈：** 下载成功或失败后，通过 `messagebox` 弹出提示。
> 
> 
> 请输出完整的、单文件的 Python 代码，我将直接保存为 `mac_down.py`。

**操作：** 将 AI 生成的代码保存到你的桌面，命名为 `mac_down.py`。建议先运行 `python3 mac_down.py` 测试一下能否下载。

---

### 第三阶段：封装成 Mac 软件 (打包)

为了让你以后不需要打开终端敲代码，像打开 App 一样使用它，我们需要打包。

1. 在终端中，进入代码所在的目录（例如桌面）：
```bash
cd ~/Desktop

```


2. **执行打包命令：**
```bash
pyinstaller --noconsole --onefile --name="YoutubeTool" mac_down.py

```


* `--noconsole`: 运行时不显示黑色的终端窗口。
* `--onefile`: 打包成一个独立的 Unix 可执行文件。


3. **获取成品：**
* 命令跑完后，桌面会出现一个 `dist` 文件夹。
* 里面的 **`YoutubeTool`** 就是你的最终程序。



---

### 第四阶段：常见问题与权限 (Mac 专属)

由于这是你自己写的软件，没有苹果的签名，第一次打开可能会被拦截。

1. **如何打开：**
* 不要直接双击（可能会提示“无法打开，因为无法验证开发者”）。
* **正确姿势：** 对着 `YoutubeTool` 图标 **点击右键 -> 选择“打开” (Open)**。
* 在弹出的警告框中点击 **“打开” (Open)** 即可。以后就可以直接双击了。


2. **关于 Chrome Cookie：**
* 程序运行时，请确保你的 Google Chrome 浏览器是**关闭状态**（或者至少没有在进行敏感操作），否则 `yt-dlp` 有时会因为数据库被锁定而无法读取 Cookie。
* 如果报错 "Could not copy Chrome cookie database"，请彻底退出 Chrome (Cmd+Q) 后再试。



**下一步：** 你现在可以去让 AI 写代码并打包了。如果在打包过程中报错，请直接告诉我报错信息。

---

## 第五阶段：Docker WebUI 本地网页版（推荐）

如果你更喜欢“本地网页”而不是桌面 GUI，可以用 Docker 直接起一个 WebUI，在浏览器里输入链接、选择格式、点击下载。

### 1) 准备环境
- 安装 Docker Desktop（Mac 官方版本即可）

### 2) 构建镜像（在本项目目录）
```bash
docker build -t ytdlp-webui .
```

### 3) 启动容器
把下载文件直接保存到你本机 `~/Downloads`：
```bash
docker run --rm -it -p 8080:8080 \
  -v "$HOME/Downloads:/downloads" \
  ytdlp-webui
```

启动后打开浏览器：
```
http://localhost:8080
```

### 4) 选配：挂载 cookies.txt（解决限速/403）
先用浏览器导出 `cookies.txt`，然后挂载并传入环境变量：
```bash
docker run --rm -it -p 8080:8080 \
  -v "$HOME/Downloads:/downloads" \
  -v "$HOME/Downloads/cookies.txt:/cookies.txt:ro" \
  -e COOKIES_PATH=/cookies.txt \
  ytdlp-webui
```

### 5) 也可以用 docker compose
```bash
docker compose up --build
```

### 使用提示
- WebUI 里可选择 “视频/音频/分辨率”。
- 下载文件会出现在你本机 `~/Downloads` 里。
- 如需改保存位置，把 `-v 本地路径:/downloads` 换成你想要的目录。
